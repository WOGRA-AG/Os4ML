<app-dialog-header (closeDialog)="close()">
  {{ 'prediction.create' | translate }}
</app-dialog-header>

<mat-stepper [linear]="false" orientation="horizontal" #stepper>
  <ng-template matStepperIcon="edit">
    <mat-icon>check</mat-icon>
  </ng-template>
  <mat-step
    label="{{ 'dialog.create_prediction.step_data' | translate }}"
    completed="{{ stepperStep > 0 }}">
    <mat-dialog-content>
      <app-create-prediction
        [solution]="solution"
        (predictionChange)="updatePrediction($event)"
        #createPrediction>
      </app-create-prediction>
    </mat-dialog-content>
  </mat-step>

  <mat-step
    completed="false"
    label="{{ 'dialog.create_prediction.step_download' | translate }}">
  </mat-step>
</mat-stepper>

<mat-dialog-actions align="end">
  <ng-container
    *ngIf="
      stepperStep === 0;
      then stepDataActions;
      else stepDownloadActions
    "></ng-container>
</mat-dialog-actions>

<ng-template #stepDataActions>
  <a
    id="download-prediction-template-link"
    *ngIf="solution.predictionTemplateUrl"
    [href]="solution.predictionTemplateUrl"
    target="_blank"
    mat-stroked-button
    color="primary">
    {{ 'dialog.create_prediction.download_template' | translate }}
  </a>
  <app-status-spinner
    *ngIf="running"
    [status]="
      prediction.status || 'message.pipeline.default' | translate
    "></app-status-spinner>
  <button
    id="predict-dialog-button"
    mat-raised-button
    color="primary"
    type="submit"
    (click)="predict(stepper, createPrediction)"
    [disabled]="running || !createPrediction.valid()">
    {{ 'prediction.action' | translate }}
  </button>
</ng-template>

<ng-template #stepDownloadActions>
  <button mat-flat-button (click)="back(stepper)">
    <mat-icon>arrow_back_ios</mat-icon>
    {{ 'action.previous_step' | translate }}
  </button>
  <a
    id="download-prediction-result-link"
    *ngIf="prediction.resultUrl"
    [href]="prediction.resultUrl"
    target="_blank"
    mat-raised-button
    color="primary">
    {{ 'dialog.create_prediction.download_result' | translate }}
  </a>
  <button
    mat-raised-button
    color="primary"
    type="submit"
    (click)="close()"
    [disabled]="false">
    {{ 'action.last_step' | translate }}
  </button>
</ng-template>
